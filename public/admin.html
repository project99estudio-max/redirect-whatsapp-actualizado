<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PANEL ADMIN</title>
<style>
  *{ box-sizing:border-box; }

  :root{
    --bg1:#4b0082; --bg2:#000000; --particle:#c7b3ff;
    --card:#1c1433f0; --edge1:rgba(174,143,255,.16); --edge2:rgba(255,255,255,.55);
    --text:#ffffff; --muted:#c9c0f2; --btn-bg:#1e1935;
    --neonA:#b985ff; --neonB:#efe6ff; --pulse:#7f5cff;

    --listColW:108px;
    --saveBtnW:160px;

    --cfgLabelW:110px;
    --cfgNumberW:60px;
    --cfgSuffixW:56px;
    --cfgGap:8px;
  }

  html,body{
    height:100%;margin:0;color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    background:radial-gradient(circle at 30% -10%,var(--bg1),var(--bg2));
  }
  canvas{position:fixed;inset:0;width:100%;height:100%;z-index:0}
  .shell{position:relative;z-index:2;max-width:760px;margin:4px auto 32px;padding:0 14px}

  .logo-wrap{display:flex;justify-content:center}
  .logo{width:240px;display:block;filter:drop-shadow(0 6px 18px rgba(115,90,255,.35));margin:10px auto -36px;}

  .card,.card-mini{
    position:relative;z-index:1;margin:0 auto;
    background:linear-gradient(var(--card),var(--card)) padding-box,
               linear-gradient(145deg,var(--edge1),var(--edge2),var(--edge1)) border-box;
    border:1px solid transparent;border-radius:20px;
    box-shadow:0 12px 40px rgba(0,0,0,.45);
  }
  .card-inner{padding:16px 14px}
  .card-mini{ overflow:hidden; }
  .mini-inner{padding:14px 14px}
  h1{text-align:center;margin:2px 0 8px;font-size:24px;letter-spacing:.4px}
  p,small{color:var(--muted);text-align:center;margin:0}

  .btn{
    position:relative;border:none;border-radius:12px;padding:10px 12px;
    color:#fff;cursor:pointer;outline:none;background:var(--btn-bg);
    white-space:nowrap;font-weight:600;letter-spacing:.2px;text-align:center;
    box-shadow:0 6px 18px rgba(40,0,120,.22);z-index:0;
    display:flex;align-items:center;justify-content:center;
    height:36px;font-size:12.5px;
  }
  .btn:hover{filter:brightness(1.08)}
  .btn--thin::before{
    content:"";position:absolute;inset:-1px;border-radius:13px;
    background:conic-gradient(from 45deg,var(--neonA)0%,var(--neonB)18%,var(--neonA)36%,var(--neonA)100%);
    -webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);
    -webkit-mask-composite:xor;mask-composite:exclude;padding:1px;
    filter:saturate(90%) blur(.15px) opacity(.85);
  }
  .btn--sm{ height:34px; padding:8px 10px; font-size:12px; }

  .actions-top{
    display:grid;
    grid-template-columns:1fr 1fr 1fr;
    gap:8px;
    margin:8px 0 6px;
  }
  .actions-bottom{display:flex;justify-content:center;margin:18px 0 6px;position:relative;}
  #btnRot{ font-size:11.4px; }

  .btn--main{
    position:relative;
    font-size:15px; padding:12px 16px; min-width:220px;
    background:#231a44;
    box-shadow:0 10px 28px rgba(127,92,255,.35), 0 0 22px rgba(127,92,255,.22);
  }

  #statsPanel{
    position:fixed;
    inset:0;
    display:none;
    align-items:center;
    justify-content:center;
    background:rgba(5,0,15,.7);
    z-index:999;
    padding:16px;
  }
  #statsPanel .card-mini{
    max-width:420px;
    width:100%;
    background:radial-gradient(circle at 30% -20%, #2e1759, #120428 80%) padding-box,
               linear-gradient(145deg,var(--edge1),var(--edge2),var(--edge1)) border-box;
    border-radius:22px;
    box-shadow:0 18px 50px rgba(0,0,0,.8);
    border:1px solid rgba(255,255,255,0.15);
    color:#efeaff;
  }

  .stats-filters {
    display:flex;
    justify-content:space-between;
    gap:6px;
    flex-wrap:nowrap;
  }
  .stats-filters .btn{
    flex:1;
    font-size:12px;
    height:34px;
    padding:0 4px;
  }
  .stats-filters .btn.active{
    background:#3a2b66;
    box-shadow:0 0 12px rgba(127,92,255,.45);
    filter:brightness(1.1);
  }
  @media(max-width:480px){
    .stats-filters .btn{
      font-size:10px;
      height:30px;
      padding:0 2px;
    }
  }
</style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="shell">
  <div class="logo-wrap">
    <img class="logo" src="/insomnia-logo.png" alt="Insomnia Logo">
  </div>

  <div class="card">
    <div class="card-inner">
      <h1>PANEL ADMIN</h1>
      <div class="actions-top">
        <button class="btn btn--thin btn--sm" id="btnView">Ver lista</button>
        <button class="btn btn--thin btn--sm" id="btnRot">Resetear rotaciÃ³n</button>
        <button class="btn btn--thin btn--sm" id="btnReset">Borrar lista</button>
      </div>
      <div class="actions-bottom">
        <button class="btn btn--main" id="btnAdd">AGREGAR CAJERA</button>
      </div>
      <div id="list"></div>
      <div class="save-wrap" id="saveWrap" style="display:none">
        <button class="btn btn--thin" id="btnSaveFinal">Guardar</button>
      </div>
      <p id="msg"></p>
    </div>
  </div>

  <div class="stats-card" id="btnStats">
    <span>ðŸ“Š EstadÃ­sticas</span>
  </div>

  <div id="statsPanel">
    <div class="card-mini">
      <div class="mini-inner">
        <p style="text-align:center;color:#dcd2ff;margin-bottom:10px;font-weight:600;">Clientes nuevos</p>
        <div class="stats-filters">
          <button class="btn btn--thin btn--sm active" data-range="today">Hoy</button>
          <button class="btn btn--thin btn--sm" data-range="yesterday">Ayer</button>
          <button class="btn btn--thin btn--sm" data-range="week">Semana actual</button>
          <button class="btn btn--thin btn--sm" data-range="month">Mes actual</button>
        </div>
        <div id="statsResults" style="margin-top:14px;font-size:13px;color:#e7e0ff;"></div>
      </div>
    </div>
  </div>
</div>

<script>
const $=s=>document.querySelector(s);
const msg=$("#msg"),tokenInput=$("#token")||{value:""},list=$("#list"),saveWrap=$("#saveWrap");
const statsPanel=$("#statsPanel"),statsResults=$("#statsResults");

$("#btnStats").onclick=()=>{statsPanel.style.display='flex';loadStatsRange('today');};
statsPanel.addEventListener("click",e=>{if(e.target===statsPanel)statsPanel.style.display='none';});

document.querySelectorAll(".stats-filters .btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".stats-filters .btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    loadStatsRange(btn.dataset.range);
  });
});

function show(t,ok=1){msg.textContent=t;msg.className=ok?"ok":"err"}

async function loadStatsRange(range){
  const t=tokenInput.value.trim();if(!t)return show("PonÃ© token",0);
  try{
    statsResults.textContent="Cargando...";
    const r=await fetch(`/api/stats-range?token=${encodeURIComponent(t)}&range=${range}`);
    const j=await r.json();
    if(!j.ok)return statsResults.textContent="Error al obtener datos";
    if(!j.stats?.length)return statsResults.textContent="Sin datos para este perÃ­odo.";
    statsResults.innerHTML=j.stats.map(s=>`<div style="display:flex;justify-content:space-between;margin:3px 0;"><span>${s.name||"Sin nombre"}</span><span style="font-weight:600">${s.count||0} clientes</span></div>`).join("");
  }catch(e){statsResults.textContent="Error al obtener datos";}
}
</script>
</body>
</html>
